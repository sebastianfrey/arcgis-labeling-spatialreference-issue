import{qD as Xt,W as a,a2 as Qt,kx as h,Z as Lt,ap as fe,bV as ge,hE as ve,c1 as xe,a1 as be}from"./index-Cf67L9ml.js";import{d as Ft,B as m,F as X,G as we,n as z,H as $e,I as Se,p as Mt,q as K,_ as r,J as Vt,E as te,y as ee,g as u,P as V,b as A,N as Z,a as y,O as ze,U as P,r as k,h as c,K as Nt,Q as b,C as Ve,R as Te,j as Oe,s as W,Y as v,z as x,X as $,w as De,v as Ae,f as Ht,M as oe,V as ie,i as Re,$ as Bt,o as Ce,T as ut,k as Tt,a0 as Pe,a1 as Fe,a2 as U,a3 as vt,l as xt,a4 as Me,c as Q,a5 as He,m as f,x as _e,a6 as Et,a7 as Ot}from"./GraphShaderModule-BenlGmbL.js";const Do={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}};var Zt;(function(e){e[e.Geographic=0]="Geographic",e[e.Arithmatic=1]="Arithmatic"})(Zt||(Zt={}));const Ao=3.14159265359/180,qe=3.14159265359/128,Ro=1,Ie=1.1,ke=1,Co=24,Po=8,We=1e-5,Ue=.05,Ge=1e-30,Le=4,Ne=0,Be=2,Fo=2,Mo=3,Ho=0,_o=3,Ee=16777216,qo=1.1;function jt(e){const t=m(12.9898),o=m(78.233),i=m(43758.5453),s=Mt(e,Vt(t,o)),n=X(s,m(3.14));return te(ee(n).multiply(i))}function E(e){return Ft(e,m(Ge))}function Ze(e,t){return e.x.multiply(t.y).subtract(t.x.multiply(e.y))}function je(e){return e.multiply(2).subtract(1)}function G(e,t){const o=m(2**t);return X(we(e.divide(o)),m(2))}function Io(e,t){return z(G(e,t),m(.5))}function zt(e,t){return G(e,t+Xt)}function Ke(e,t){return G(e,t)}function Ye(e){const t=G(e.z,7),o=m(1).subtract(t),i=e.xyz.subtract($e(0,0,m(128)));return o.multiply(e).add(t.multiply(i))}function Je(e){const t=Se(.99609375,.0038909912109375,1519918441772461e-20,59371814131736755e-24);return Mt(e,t)}function ko(e){return K(K(K(e.x,e.y),e.z),e.w)}function Wo(e){return new r(1).subtract(e)}function Uo(e){return e.subtract(new r(1))}function Go(e,t){return e.subtract(new r(t))}let D=class extends V{getVisualVariableData(t){if(!this._vvData){const o=this.getAttributeDataCoords(t);this._vvData=A(this.visualVariableData,o).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){const o=Ye(t),i=this.size,s=Z(o.x),n=Z(o.y).multiply(Z(256)),l=Z(o.z).multiply(Z(256)).multiply(Z(256)),p=m(s.add(n).add(l)),d=X(p,i),g=p.subtract(d).divide(i);this._uv=new y(d,g).add(.5).divide(i)}return this._uv}getFilterData(t){const o=this.getAttributeDataCoords(t);return A(this.filterFlags,o).setDebugName("storage0")}getAnimationData(t){const o=this.getAttributeDataCoords(t);return A(this.animation,o).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){const o=this.getAttributeDataCoords(t);return A(this.dataDriven0,o).setDebugName("storage30")}getDataDrivenData1(t){const o=this.getAttributeDataCoords(t);return A(this.dataDriven1,o).setDebugName("storage31")}getDataDrivenData2(t){const o=this.getAttributeDataCoords(t);return A(this.dataDriven2,o).setDebugName("storage32")}getGPGPUData(t){const o=this.getAttributeDataCoords(t);return A(this.gpgpu,o).setDebugName("storage4")}getLocalTimeOrigin(t){const o=this.getAttributeDataCoords(t);return A(this.localTimeOrigin,o).x.setDebugName("storage5")}getFilterFlags(t){return Qt("webgl-ignores-sampler-precision")?ze(this.getFilterData(t).x.multiply(m(255))):this.getFilterData(t).x.multiply(m(255))}getLabelVisibility(t){const o=this.getFilterData(t).y.multiply(255);return new r(1).subtract(o)}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}};a([u(P)],D.prototype,"filterFlags",void 0),a([u(P)],D.prototype,"animation",void 0),a([u(P)],D.prototype,"gpgpu",void 0),a([u(P)],D.prototype,"localTimeOrigin",void 0),a([u(P)],D.prototype,"visualVariableData",void 0),a([u(P)],D.prototype,"dataDriven0",void 0),a([u(P)],D.prototype,"dataDriven1",void 0),a([u(P)],D.prototype,"dataDriven2",void 0),a([u(r)],D.prototype,"size",void 0);let Dt=class extends V{};a([u(r)],Dt.prototype,"activeReasons",void 0),a([u(r)],Dt.prototype,"highlightAll",void 0);let ot=class extends V{};a([u(y)],ot.prototype,"position",void 0),a([u(r)],ot.prototype,"distance",void 0),a([u(r)],ot.prototype,"smallSymbolDistance",void 0),a([u(r)],ot.prototype,"smallSymbolSizeThreshold",void 0);let w=class extends V{};a([u(k)],w.prototype,"displayViewScreenMat3",void 0),a([u(k)],w.prototype,"displayViewMat3",void 0),a([u(k)],w.prototype,"displayMat3",void 0),a([u(k)],w.prototype,"viewMat3",void 0),a([u(k)],w.prototype,"tileMat3",void 0),a([u(r)],w.prototype,"displayZoomFactor",void 0),a([u(r)],w.prototype,"requiredZoomFactor",void 0),a([u(y)],w.prototype,"tileOffset",void 0),a([u(r)],w.prototype,"currentScale",void 0),a([u(r)],w.prototype,"currentZoom",void 0),a([u(r)],w.prototype,"metersPerSRUnit",void 0),a([u(r)],w.prototype,"rotation",void 0),a([u(r)],w.prototype,"pixelRatio",void 0);let B=class extends Ve{};a([c(0,$)],B.prototype,"id",void 0),a([c(1,r)],B.prototype,"bitset",void 0),a([c(2,y)],B.prototype,"pos",void 0);let _=class extends Te{};a([c(14,y)],_.prototype,"nextPos1",void 0),a([c(15,y)],_.prototype,"nextPos2",void 0);let bt=class extends Ae{},H=class extends Oe{clip(t,o){let i=new r(0);const s=this.storage.getFilterFlags(t);if(i=i.add(m(2).multiply(m(1).subtract(zt(s,0)))),this.inside?i=i.add(m(2).multiply(m(1).subtract(zt(s,1)))):this.outside?i=i.add(m(2).multiply(zt(s,1))):this.highlight&&(i=i.add(m(2).multiply(m(1).subtract(this._checkHighlight(s))))),o!=null){const n=new r(1).subtract(W(o.x,this.view.currentZoom)),l=W(o.y,this.view.currentZoom);i=i.add(new r(2).multiply(n.add(l)))}return i}getFragmentOutput(t,o,i=new r(1/255)){const s=new De;return s.fragColor=this._maybeWriteHittest(o)??this._maybeHighlight(t,i)??t,s}_maybeHighlight(t,o){return this.highlight?new v(t.rgb,W(o,t.a)):null}_checkHighlight(t){let o=this._checkHighlightBit(t,0);for(let i=1;i<Xt;i++)o=o.add(this._checkHighlightBit(t,i));return W(new r(.1),o.add(this.highlight.highlightAll))}_checkHighlightBit(t,o){return Ke(t,o).multiply(G(this.highlight.activeReasons,o))}maybeRunHittest(t,o,i){if(this.hittestRequest==null)return null;const s=this.hittest(t,o,i);let n=x(z(s,this.hittestRequest.distance),new r(2),new r(0));const l=this.storage.getAttributeDataCoords(t.id),p=je(l);n=n.add(this.clip(t.id,t.zoomRange));const d=new v(new r(1/255),0,0,0);return{glPointSize:new r(1),glPosition:new v(p,n,1),color:d}}_maybeWriteHittest(t){return this.hittestRequest!=null?t.color:null}};a([Nt],H.prototype,"inside",void 0),a([Nt],H.prototype,"outside",void 0),a([b(Dt)],H.prototype,"highlight",void 0),a([u(D)],H.prototype,"storage",void 0),a([u(w)],H.prototype,"view",void 0),a([b(ot)],H.prototype,"hittestRequest",void 0);function Xe(e,t){return Mt(e,Fe(t))}function it(e,t,o){const i=o.subtract(t),s=Xe(e.subtract(t),i),n=Ht(s.divide(oe(i)),new r(0),new r(1));return ie(e,t.add(n.multiply(o.subtract(t))))}function Qe(e){const t=Re(e);return W(t.x.add(t.y).add(t.z),new r(1.05))}function to(e,t,o,i){const s=new k(o.x.multiply(i.y).subtract(i.x.multiply(o.y)),i.x.multiply(t.y).subtract(t.x.multiply(i.y)),t.x.multiply(o.y).subtract(o.x.multiply(t.y)),o.y.subtract(i.y),i.y.subtract(t.y),t.y.subtract(o.y),i.x.subtract(o.x),t.x.subtract(i.x),o.x.subtract(t.x)),n=t.x.multiply(o.y.subtract(i.y)),l=o.x.multiply(i.y.subtract(t.y)),p=i.x.multiply(t.y.subtract(o.y)),d=n.add(l).add(p);return new r(1).divide(d).multiply(s.multiply(new $(1,e)))}function eo(e,t,o,i){return Ft(Qe(to(e,t,o,i)),new r(1))}function oo(e,t,o,i){const s=o.subtract(t),n=i.subtract(t),l=Ze(s,n),p=Bt(Ce(l,new r(Ue)),z(l,new r(-.05)));return ut([Bt(Pe(p),eo(e.xy,t,o,i)),new r(-1)],[!0,()=>{const d=it(e,t,o),g=it(e,o,i),S=it(e,i,t);return Tt(Tt(d,g),S)}])}function ae(e){return e.distance.add(1)}function _t(e,t,o){const{viewMat3:i,tileMat3:s}=e.view,n=i.multiply(s),l=n.multiply(new $(t.pos,1)),p=n.multiply(new $(o.nextPos1,1)),d=n.multiply(new $(o.nextPos2,1));return oo(e.hittestRequest.position,l.xy,p.xy,d.xy)}function Jo(e,t,o){return ie(e,o).subtract(t)}let rt=class extends V{getColor(t,o,i){return ut([Me(E(t),i),o],[xt(t,this.values.first()),this.colors.first()],[vt(t,this.values.last()),this.colors.last()],[!0,()=>{const s=this.values.findIndex(g=>z(g,t)),n=this.values.get(s),l=s.subtract(1),p=this.values.get(l),d=t.subtract(p).divide(n.subtract(p));return Q(this.colors.get(l),this.colors.get(s),d)}])}};a([u(U.ofType(v,8))],rt.prototype,"colors",void 0),a([u(U.ofType(r,8))],rt.prototype,"values",void 0);let nt=class extends V{getOpacity(t){return ut([E(t),new r(1)],[xt(t,this.opacityValues.first()),this.opacities.first()],[vt(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const o=this.opacityValues.findIndex(p=>z(p,t)),i=this.opacityValues.get(o),s=o.subtract(1),n=this.opacityValues.get(s),l=t.subtract(n).divide(i.subtract(n));return Q(this.opacities.get(s),this.opacities.get(o),l)}])}};a([u(U.ofType(r,8))],nt.prototype,"opacities",void 0),a([u(U.ofType(r,8))],nt.prototype,"opacityValues",void 0);function se(e){return e.visualVariableSizeMinMaxValue!=null||e.visualVariableSizeScaleStops!=null||e.visualVariableSizeStops!=null||e.visualVariableSizeUnitValue!=null}function io(e,t,o){var i,s,n,l;if(se(e)){const p=e.storage.getSizeValue(t);return((i=e.visualVariableSizeMinMaxValue)==null?void 0:i.getSize(p,o))??((s=e.visualVariableSizeScaleStops)==null?void 0:s.getSizeForViewScale(e.view.currentScale))??((n=e.visualVariableSizeStops)==null?void 0:n.getSize(p,o))??((l=e.visualVariableSizeUnitValue)==null?void 0:l.getSize(p,o))}return o}function qt(e,t,o,i=new He(!1)){if(e.visualVariableColor==null)return o;const s=e.storage.getColorValue(t);return e.visualVariableColor.getColor(s,o,i)}function It(e,t){if(e.visualVariableOpacity==null)return new r(1);const o=e.storage.getOpacityValue(t);return e.visualVariableOpacity.getOpacity(o)}function ti(e,t){if(e.visualVariableRotation==null)return k.identity();const o=e.storage.getRotationValue(t);return e.visualVariableRotation.getVVRotationMat3(o)}function ei(e,t){if(e.visualVariableRotation==null)return new r(0);const o=e.storage.getRotationValue(t);return e.visualVariableRotation.getNormalizedAngle(o)}let lt=class extends B{};a([c(3,v)],lt.prototype,"color",void 0),a([c(4,y)],lt.prototype,"zoomRange",void 0);let j=class extends H{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,o){const i=It(this,t.id),s=qt(this,t.id,t.color).multiply(i),n=this.view.displayViewScreenMat3.multiply(new $(t.pos.xy,1)),l=this.clip(t.id,t.zoomRange);return{glPosition:new v(n.xy,l,1),color:s,...this.maybeRunHittest(t,o,null)}}fragment(t){return this.getFragmentOutput(t.color,t,new r(0))}hittest(t,o){return _t(this,t,o)}};a([b(rt)],j.prototype,"visualVariableColor",void 0),a([b(nt)],j.prototype,"visualVariableOpacity",void 0),a([h(0,f(lt)),h(1,f(_))],j.prototype,"vertex",null),a([h(0,f(bt))],j.prototype,"fragment",null);let Y=class extends V{getPatternOffsetAtTileOrigin(t,o=new r(0),i=new r(1)){const s=new y(Ee).divide(t);let n=t.multiply(te(this.maxIntsToLocalOrigin.multiply(s))).add(this.tileOffsetFromLocalOrigin).subtract(new r(.5).multiply(t));return n=new y(n.x.multiply(i).subtract(n.y.multiply(o)),n.x.multiply(o).add(n.y.multiply(i))),X(n,t)}};a([u(y)],Y.prototype,"tileOffsetFromLocalOrigin",void 0),a([u(y)],Y.prototype,"maxIntsToLocalOrigin",void 0);let J=class extends V{};a([u(y)],J.prototype,"size",void 0),a([u(P)],J.prototype,"texture",void 0);let L=class extends lt{};a([c(5,v)],L.prototype,"tlbr",void 0),a([c(6,r)],L.prototype,"width",void 0),a([c(7,r)],L.prototype,"height",void 0),a([c(8,y)],L.prototype,"offset",void 0),a([c(9,y)],L.prototype,"scale",void 0),a([c(10,r)],L.prototype,"angle",void 0);let ao=class extends bt{};function so(e,t,o,i,s){const n=Ft(G(s,Be),m(1)),l=Je(new v(e,0));return x(n,Et(i.divide(t.x),o.divide(t.y),0,Ot(o.divide(t.x)),i.divide(t.y),0,jt(Vt(l,0)),jt(Vt(0,l)),1),Et(i.divide(t.x),o.divide(t.y),0,Ot(o.divide(t.x)),i.divide(t.y),0,0,0,1))}function re(e,t){const o=e.view.requiredZoomFactor,i=new y(t.width,t.height),s=i.multiply(t.scale).multiply(o),n=t.angle.multiply(qe),l=ee(n),p=_e(n),d=so(t.id,s,l,p,t.bitset),g=e.localTileOffset.getPatternOffsetAtTileOrigin(i,l,p),S=o.multiply(t.scale).multiply(t.offset.subtract(g)).divide(s),T=new $(t.pos,1),q=d.multiply(T).xy.subtract(S),R=t.tlbr.divide(e.mosaicInfo.size.xyxy);let O=G(t.bitset,Le);return e.visualVariableColor!=null&&(O=x(E(e.storage.getColorValue(t.id)),new r(0),O)),{tileTextureCoord:q,tlbr:R,sampleAlphaOnly:O}}function ne(e,t){const o=X(t.tileTextureCoord,new r(1)),i=Q(t.tlbr.xy,t.tlbr.zw,o);let s=A(e.mosaicInfo.texture,i);return s=x(z(t.sampleAlphaOnly,new r(.5)),s.aaaa,s),t.color.multiply(s)}let pt=class extends j{vertex(t,o){return{...super.vertex(t,o),...re(this,t)}}fragment(t){const o=ne(this,t);return this.getFragmentOutput(o,t,new r(0))}};a([u(J)],pt.prototype,"mosaicInfo",void 0),a([u(Y)],pt.prototype,"localTileOffset",void 0),a([h(0,f(L)),h(1,f(_))],pt.prototype,"vertex",null),a([h(0,f(ao))],pt.prototype,"fragment",null);let kt=class extends V{getSize(t,o){const i=this.minMaxValueAndSize.xy,s=this.minMaxValueAndSize.zw;return x(E(t),o,()=>{const n=t.subtract(i.x).divide(i.y.subtract(i.x)),l=Ht(n,new r(0),new r(1));return s.x.add(l.multiply(s.y.subtract(s.x)))})}};a([u(v)],kt.prototype,"minMaxValueAndSize",void 0);let ht=class extends V{getSizeForViewScale(t){return ut([xt(t,this.values.first()),this.sizes.first()],[vt(t,this.values.last()),this.sizes.last()],[!0,()=>{const o=this.values.findIndex(p=>z(p,t)),i=this.values.get(o),s=o.subtract(1),n=this.values.get(s),l=t.subtract(n).divide(i.subtract(n));return Q(this.sizes.get(s),this.sizes.get(o),l)}])}};a([u(U.ofType(r,8))],ht.prototype,"sizes",void 0),a([u(U.ofType(r,8))],ht.prototype,"values",void 0);let ft=class extends V{getSize(t,o){const i=ut([E(t),o],[xt(t,this.values.first()),this.sizes.first()],[vt(t,this.values.last()),this.sizes.last()],[!0,()=>{const s=this.values.findIndex(g=>z(g,t)),n=this.values.get(s),l=s.subtract(1),p=this.values.get(l),d=t.subtract(p).divide(n.subtract(p));return Q(this.sizes.get(l),this.sizes.get(s),d)}]);return x(E(i),o,i)}};a([u(U.ofType(r,8))],ft.prototype,"sizes",void 0),a([u(U.ofType(r,8))],ft.prototype,"values",void 0);let Wt=class extends V{getSize(t,o){return x(E(t),o,t.multiply(this.unitValueToPixelsRatio))}};a([u(r)],Wt.prototype,"unitValueToPixelsRatio",void 0);class N extends B{}a([c(3,v)],N.prototype,"color",void 0),a([c(4,y)],N.prototype,"offset",void 0),a([c(5,y)],N.prototype,"normal",void 0),a([c(6,r)],N.prototype,"halfWidth",void 0),a([c(7,r)],N.prototype,"referenceHalfWidth",void 0),a([c(8,y)],N.prototype,"zoomRange",void 0);let le=class extends bt{},gt=class extends V{};function ue(e){return K(new r(Ie).multiply(W(e,new r(ke))),new r(1))}function ro(e,t){const{halfWidth:o,normal:i}=e,s=ue(o),n=oe(i).multiply(o);return Ht(s.multiply(o.subtract(n)).divide(t.add(s).subtract(new r(1))),new r(0),new r(1))}function no(e,t){const{id:o,halfWidth:i,referenceHalfWidth:s}=t;if(se(e)){const n=new r(2).multiply(s),l=io(e,o,n);return new r(.5).multiply(i.divide(K(s,new r(We)))).multiply(l)}return i}function pe(e,t){const{id:o,offset:i,pos:s,normal:n,zoomRange:l}=t,{displayViewScreenMat3:p,displayViewMat3:d}=e.view,g=qt(e,o,t.color),S=It(e,o),T=no(e,t),q=new r(.5).multiply(e.antialiasingControls.antialiasing),R=K(T.add(q),new r(.45)).add(new r(.1).multiply(q)),O=ue(R).multiply(R).multiply(i),$t=d.multiply(new $(O,new r(0))),St=p.multiply(new $(s,new r(1))).add($t),Gt=new r(2).multiply(W(T,new r(0))).add(e.clip(o,l)),he=new v(St.xy,Gt,1);return{color:g,opacity:S,halfWidth:R,normal:n,scaledOffset:O,scaledHalfWidth:T,glPosition:new v(he.xy,Gt,1)}}function wt(e,t){const{opacity:o,color:i}=e,s=ro(e,t);return o.multiply(i).multiply(s)}a([u(r)],gt.prototype,"antialiasing",void 0),a([u(r)],gt.prototype,"blur",void 0);class C extends H{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,o){const i=pe(this,t);return{...i,...this.maybeRunHittest(t,o,i.halfWidth)}}fragment(t){const o=wt(t,this.antialiasingControls.blur);return this.getFragmentOutput(o,t)}hittest(t,o,i){const{viewMat3:s,tileMat3:n}=this.view,l=s.multiply(n),p=l.multiply(new $(t.pos,1)),d=l.multiply(new $(o.nextPos1,1)),g=l.multiply(new $(o.nextPos2,1)),{distance:S,smallSymbolDistance:T,smallSymbolSizeThreshold:q}=this.hittestRequest,R=W(i,q.multiply(.5)).multiply(S.subtract(T)),O=this.hittestRequest.position;return Tt(it(O,p.xy,d.xy),it(O,p.xy,g.xy)).subtract(i).add(R)}}a([u(gt)],C.prototype,"antialiasingControls",void 0),a([b(rt)],C.prototype,"visualVariableColor",void 0),a([b(nt)],C.prototype,"visualVariableOpacity",void 0),a([b(kt)],C.prototype,"visualVariableSizeMinMaxValue",void 0),a([b(ht)],C.prototype,"visualVariableSizeScaleStops",void 0),a([b(ft)],C.prototype,"visualVariableSizeStops",void 0),a([b(Wt)],C.prototype,"visualVariableSizeUnitValue",void 0),a([h(0,f(N)),h(1,f(_))],C.prototype,"vertex",null),a([h(0,f(le))],C.prototype,"fragment",null);class I extends B{}a([c(3,y)],I.prototype,"offset",void 0),a([c(4,v)],I.prototype,"color",void 0),a([c(5,y)],I.prototype,"normal",void 0),a([c(6,r)],I.prototype,"halfWidth",void 0),a([c(7,r)],I.prototype,"referenceHalfWidth",void 0),a([c(8,y)],I.prototype,"zoomRange",void 0);let ce=class extends le{};function Ut(e,t,o){const{id:i,bitset:s}=t,n=G(s,Ne),l=z(n,new r(.5)),p=pe(e,t),d=x(l,p.halfWidth,new r(0)),g=It(e,i),S=qt(e,i,t.color),T=x(l,t.color,S.multiply(g)),q=e.view.displayViewScreenMat3.multiply(new $(t.pos.xy,1)),R=e.clip(t.id),O=new v(q.xy,R,1),$t=x(l,p.glPosition,O),St=o&&e.maybeRunHittest(t,o,l);return{isOutline:n,color:T,opacity:new r(1),halfWidth:d,normal:p.normal,glPosition:$t,...St}}let M=class extends H{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}};a([u(gt)],M.prototype,"antialiasingControls",void 0),a([b(rt)],M.prototype,"visualVariableColor",void 0),a([b(nt)],M.prototype,"visualVariableOpacity",void 0),a([b(kt)],M.prototype,"visualVariableSizeMinMaxValue",void 0),a([b(ht)],M.prototype,"visualVariableSizeScaleStops",void 0),a([b(ft)],M.prototype,"visualVariableSizeStops",void 0),a([b(Wt)],M.prototype,"visualVariableSizeUnitValue",void 0);class At extends M{vertex(t,o){return Ut(this,t,o)}fragment(t){const{color:o,isOutline:i}=t,s=z(i,new r(.5)),n=wt(t,this.antialiasingControls.blur),l=x(s,n,o),p=x(s,new r(1/255),new r(0));return this.getFragmentOutput(l,t,p)}hittest(t,o,i){return x(i,ae(this.hittestRequest),_t(this,t,o))}}a([h(0,f(I)),h(1,f(_))],At.prototype,"vertex",null),a([h(0,f(ce))],At.prototype,"fragment",null);let Rt=class extends lt{};a([c(5,v)],Rt.prototype,"tlbr",void 0),a([c(6,r)],Rt.prototype,"inverseRasterizationScale",void 0);class lo extends bt{}function uo(e){const t=new r(1),o=new r(0);return new k(t.divide(e.x),o.divide(e.y),0,Ot(o.divide(e.x)),t.divide(e.y),0,0,0,1)}function de(e,t){const o=t.tlbr.xy,i=t.tlbr.zw,s=i.x.subtract(o.x),n=o.y.subtract(i.y),l=new y(s,n).multiply(t.inverseRasterizationScale),p=l.multiply(e.view.requiredZoomFactor),d=uo(p),g=e.localTileOffset.getPatternOffsetAtTileOrigin(l).divide(p),S=new $(t.pos,1);return{tileTextureCoord:d.multiply(S).xy.subtract(g),tlbr:t.tlbr.divide(e.mosaicInfo.size.xyxy)}}function ye(e,t){const o=X(e.tileTextureCoord,new r(1)),i=Q(e.tlbr.xy,e.tlbr.zw,o),s=A(t.texture,i);return e.color.multiply(s)}class ct extends j{vertex(t,o){return{...super.vertex(t,o),...de(this,t)}}fragment(t){const o=ye(t,this.mosaicInfo);return this.getFragmentOutput(o,t,new r(0))}}a([u(J)],ct.prototype,"mosaicInfo",void 0),a([u(Y)],ct.prototype,"localTileOffset",void 0),a([h(0,f(Rt)),h(1,f(_))],ct.prototype,"vertex",null),a([h(0,f(lo))],ct.prototype,"fragment",null);let Ct=class extends I{};a([c(9,v)],Ct.prototype,"tlbr",void 0),a([c(10,r)],Ct.prototype,"inverseRasterizationScale",void 0);let me=class extends ce{},dt=class extends At{vertex(t,o){return{...Ut(this,t,o),...de(this,t)}}fragment(t){const{isOutline:o}=t,i=z(o,new r(.5)),s=wt(t,this.antialiasingControls.blur),n=ye(t,this.mosaicInfo),l=x(i,s,n),p=x(i,new r(1/255),new r(0));return this.getFragmentOutput(l,t,p)}};a([u(J)],dt.prototype,"mosaicInfo",void 0),a([u(Y)],dt.prototype,"localTileOffset",void 0),a([h(0,f(Ct)),h(1,f(_))],dt.prototype,"vertex",null),a([h(0,f(me))],dt.prototype,"fragment",null);const po=16,Kt=1/po,co=128;class F extends B{}a([c(3,v)],F.prototype,"color",void 0),a([c(4,v)],F.prototype,"tlbr",void 0),a([c(5,r)],F.prototype,"angle",void 0),a([c(6,r)],F.prototype,"aux1",void 0),a([c(7,r)],F.prototype,"aux2",void 0),a([c(8,y)],F.prototype,"aux3",void 0),a([c(9,y)],F.prototype,"aux4",void 0),a([c(10,y)],F.prototype,"zoomRange",void 0);class yo extends me{}class yt extends M{vertex(t,o){const{aux1:i,aux2:s,aux3:n,aux4:l}=t,p={...t,width:i,height:s,offset:n,scale:l.multiply(Kt)},d={...t,halfWidth:i,referenceHalfWidth:s,offset:n,normal:l.subtract(co).multiply(Kt)},g=Ut(this,d),S=re(this,p),T=z(g.isOutline,new r(.5));return{...g,...S,...this.maybeRunHittest(t,o,T)}}fragment(t){const{isOutline:o}=t,i=z(o,new r(.5)),s=wt(t,this.antialiasingControls.blur),n=ne(this,t),l=x(i,s,n),p=x(i,new r(1/255),new r(0));return this.getFragmentOutput(l,t,p)}hittest(t,o,i){return x(i,ae(this.hittestRequest),_t(this,t,o))}}a([u(J)],yt.prototype,"mosaicInfo",void 0),a([u(Y)],yt.prototype,"localTileOffset",void 0),a([h(0,f(F)),h(1,f(_))],yt.prototype,"vertex",null),a([h(0,f(yo))],yt.prototype,"fragment",null);const wi={linear:0,rectangular:1,circular:2},$i={isAbsolute:0,isDiscrete:1},mo=8388607,ho=8388608,Si=e=>e&mo;function zi(e,t){return((t?ho:0)|e)>>>0}const Vi={isAlongLine:0,isAbsoluteSize:1,isDiscrete:2};var Yt;(function(e){e.Local="Local",e.Global="Global"})(Yt||(Yt={}));class tt{generateSource(t){const o=[];for(let s=1;s<this.length;s++)o.push(`vec4 atom${s} = texture(${t.animationTexture}, (pointer + 0.5) / size);`),o.push("pointer.x += 1.0;");for(let s=0;s<this.ins;s++)o.push("top--;"),o.push(`vec4 in${this.ins-s-1} = stack[top];`);for(let s=0;s<this.outs;s++)o.push(`vec4 out${s};`);const{microcode:i}=this;for(const s of i)o.push(s);for(let s=0;s<this.outs;s++)o.push(`stack[top] = out${s};`),o.push("top++;"),o.push(`if (top >= ${Pt}) { top = ${Pt-1}; }`);return o}}let et=128;class fo extends tt{constructor(){super(...arguments),this.opcode=++et,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}class go extends tt{constructor(){super(...arguments),this.opcode=++et,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(t){return[[this.opcode,t,0,0]]}}class vo extends tt{constructor(){super(...arguments),this.opcode=++et,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(t){return[[this.opcode,t[0]||0,t[1]||0,t[2]||0]]}}class xo extends tt{constructor(){super(...arguments),this.opcode=++et,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(t){return[[this.opcode,0,0,0],t]}}function at(e){return[`float duration = clamp(${e.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${e.startTimeOffset};`,`float repeatDelay = ${e.repeatDelay};`,`float timeOriginSelector = ${e.timeOriginSelector};`,`float repeatType = ${e.repeatType};`,`float easing = ${e.easing};`,`float playAnimation = ${e.playAnimation} * (1.0 - step(0.0, -${e.duration}));`,`float reverseAnimation = ${e.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${e.out} = oscillate ? 1.0 - of : of;`]}const bo={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},wo={Loop:1,None:2,Oscillate:3},$o={Local:1,Global:2};function st(e){const t=bo[e.easing],o=wo[e.repeatType],i=$o[e.timeOriginSelector];return[[e.duration,e.startTimeOffset,e.repeatDelay,i],[o,t,e.playAnimation,e.reverseAnimation]]}class So extends tt{constructor(){super(...arguments),this.opcode=++et,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...at({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...at({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...at({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;",`
    vec2 translation = vec2(
      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,
      sin1 * s1 * x2 + cos1 * s1 * y2 + y1
    );
    `,"out0 = vec4(translation, rotation, scale);"]}encode(t){return[[this.opcode,0,0,0],[t.translation.from[0],t.translation.from[1],t.translation.to[0],t.translation.to[1]],[t.rotation.from,t.rotation.to,t.scale.from,t.scale.to],...st(t.translation.timing),...st(t.rotation.timing),...st(t.scale.timing),[t.relativeTranslation?1:0,t.absoluteScale?1:0,0,0]]}}class zo extends tt{constructor(){super(...arguments),this.opcode=++et,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...at({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...at({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(t){return[[this.opcode,t.opacity.from,t.opacity.to,0],[t.color.from[0],t.color.from[1],t.color.from[2],t.color.from[3]],[t.color.to[0],t.color.to[1],t.color.to[2],t.color.to[3]],...st(t.color.timing),...st(t.opacity.timing)]}}const Jt={scalar:new go,vector3:new vo,vector4:new xo,animatedTransform:new So,animatedColor:new zo,ret:new fo},Vo=40,Pt=4;function Ti(e){const t=[];t.push(`float globalTime = ${e.globalTime};`),t.push(`float localTimeOrigin = ${e.localTimeOrigin};`),t.push(`vec2 pointer = ${e.animationPointer};`),t.push(`vec2 size = ${e.animationTextureSize};`),t.push("int top = 0;"),t.push(`vec4 stack[${Pt}];`),t.push(`for (int counter = 0; counter < ${Vo}; counter++) {`),t.push(`vec4 atom0 = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;"),t.push(`vec2 pixelDimensions = ${e.pixelDimensions};`),t.push("if (false) {");for(const o in Jt){const i=Jt[o];t.push(`} else if (int(atom0.x) == ${i.opcode}) {`);for(const s of i.generateSource(e))t.push(s)}return t.push("} // End if-else."),t.push("} // End for."),t.push(`${e.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),t.join(`
`)}let mt=class extends ge{constructor(e){super(e),this.debugName="",this._updatingHandles=new ve,this._idToUpdatingState=new xe}get updating(){const e=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(t=>t);if(Qt("esri-2d-log-updating")){const t=Array.from(this._idToUpdatingState.entries()).map(([o,i])=>`-> ${o}: ${i}`).join(`
`);console.log(`${this.debugName}: Updating: ${e}
-> Handles: ${this._updatingHandles.updating}
${t}`)}return e}addUpdateTracking(e,t){const o=be(()=>t.updating,i=>this._idToUpdatingState.set(e,i),{sync:!0});this.addHandles(o)}addPromise(e){return this._updatingHandles.addPromise(e)}};a([Lt({constructOnly:!0})],mt.prototype,"debugName",void 0),a([Lt({readOnly:!0})],mt.prototype,"updating",null),mt=a([fe("esri.views.2d.layers.support.UpdateTracking2D")],mt);export{ko as $,Ti as A,Ne as B,Be as C,Wo as D,Uo as E,Ho as F,J as G,Go as H,rt as I,qo as J,nt as K,kt as L,ht as M,ft as N,Wt as O,bt as P,G as Q,io as R,po as S,qt as T,Io as U,It as V,oo as W,to as X,Qe as Y,ae as Z,w as _,_o as a,j as a0,pt as a1,yt as a2,lt as a3,_ as a4,At as a5,ct as a6,dt as a7,Jo as a8,Co as a9,ti as aa,Po as ab,N as ac,C as ad,pe as ae,ro as af,Vi as b,qe as c,mt as d,$i as e,Si as f,Fo as g,Jt as h,Mo as i,E as j,Ge as k,Zt as l,Ao as m,mo as n,Do as o,B as p,Le as q,wi as r,zi as s,Yt as t,H as u,ei as v,co as w,Je as x,Ro as y,je as z};
